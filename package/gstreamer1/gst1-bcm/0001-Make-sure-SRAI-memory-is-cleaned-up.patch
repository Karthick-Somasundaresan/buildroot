From b1f0f4bcb0c4b36b03f4033617d58c757f74af06 Mon Sep 17 00:00:00 2001
From: Artur Gebicz <a.gebicz@metrological.com>
Date: Tue, 14 Jul 2020 08:52:52 +0200
Subject: [PATCH] Make sure SRAI memory is cleaned up

---
 audfilter/src/gst_brcm_aud_filter.c | 4 ++++
 vidfilter/src/gst_brcm_vid_filter.c | 3 +++
 2 files changed, 7 insertions(+)

diff --git a/audfilter/src/gst_brcm_aud_filter.c b/audfilter/src/gst_brcm_aud_filter.c
index 1c29f13..c15826c 100644
--- a/audfilter/src/gst_brcm_aud_filter.c
+++ b/audfilter/src/gst_brcm_aud_filter.c
@@ -510,6 +510,10 @@ static GstStateChangeReturn gst_brcm_aud_filter_change_state(GstElement *element
 
         nexus_free(filter);
 
+#ifdef BGST_SVP_SUPPORT
+        SRAI_Cleanup(); /* make sure srai memory is cleanup */
+#endif
+
         NxClient_Uninit();
         break;
     }
diff --git a/vidfilter/src/gst_brcm_vid_filter.c b/vidfilter/src/gst_brcm_vid_filter.c
index f0f1722..ed8a58a 100644
--- a/vidfilter/src/gst_brcm_vid_filter.c
+++ b/vidfilter/src/gst_brcm_vid_filter.c
@@ -601,6 +601,9 @@ static void nexus_free(GstBrcmVidFilter *filter)
         filter->secbuf_peshdr = NULL;
     }
 #endif
+
+    SRAI_Cleanup(); /* make sure srai memory is cleanup */
+
 #endif
     filter->playpump = NULL;
     if (filter->caps) {
-- 
2.17.1

