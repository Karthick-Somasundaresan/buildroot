From 8ea8d249d874f75e0bd5c2d9635096524e6c56bd Mon Sep 17 00:00:00 2001
From: Ievgen Mutavchi <Ievgen_Mutavchi@comcast.com>
Date: Mon, 10 Aug 2020 20:35:21 -0400
Subject: [PATCH] AMLOGIC-437: Fix buffer overflow

Happens when pending size > received size
---
 Source/websocket/WebSocketLink.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/Source/websocket/WebSocketLink.cpp b/Source/websocket/WebSocketLink.cpp
index 00b2e2da..bd8fee2b 100644
--- a/Source/websocket/WebSocketLink.cpp
+++ b/Source/websocket/WebSocketLink.cpp
@@ -175,7 +175,7 @@ namespace Web {
                         receivedSize = _pendingReceiveBytes;
                     }
 
-                    while (_pendingReceiveBytes != 0) {
+                    for (uint16_t tmp = receivedSize; _pendingReceiveBytes != 0 && tmp != 0; --tmp) {
                         *source = (*source ^ _scrambleKey[(_progressInfo & 0x3)]);
                         source++;
                         _progressInfo = ((_progressInfo + 1) & 0x03) | (_progressInfo & 0xFC);
